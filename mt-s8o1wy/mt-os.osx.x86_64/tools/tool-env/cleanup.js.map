{"version":3,"sources":["/tools/tool-env/cleanup.js"],"names":["_","require","fiberHelpers","cleanup","exports","extend","_exitHandlers","onExit","func","push","runHandlers","noYieldsAllowed","handlers","each","f","process","on","sig","once","kill","pid"],"mappings":"AAAA;AACA;;AAEA,IAAIA,IAAIC,QAAQ,YAAR,CAAR;;AAEA,IAAIC,eAAeD,QAAQ,2BAAR,CAAnB;;AAEA,IAAIE,UAAUC,OAAd;AACAJ,EAAEK,MAAF,CAASD,OAAT,EAAkB;AAChBE,iBAAe,EADC;;AAGhB;AACA;AACAC,UAAQ,gBAAUC,IAAV,EAAgB;AACtB,SAAKF,aAAL,CAAmBG,IAAnB,CAAwBD,IAAxB;AACD;AAPe,CAAlB;;AAUA,IAAIE,cAAc,SAAdA,WAAc,GAAY;AAC5BR,eAAaS,eAAb,CAA6B,YAAY;AACvC,QAAIC,WAAWT,QAAQG,aAAvB;AACAH,YAAQG,aAAR,GAAwB,EAAxB;AACAN,MAAEa,IAAF,CAAOD,QAAP,EAAiB,UAAUE,CAAV,EAAa;AAC5BA;AACD,KAFD;AAGD,GAND;AAOD,CARD;;AAUAC,QAAQC,EAAR,CAAW,MAAX,EAAmBN,WAAnB;AACAV,EAAEa,IAAF,CAAO,CAAC,QAAD,EAAW,QAAX,EAAqB,SAArB,CAAP,EAAwC,UAAUI,GAAV,EAAe;AACrDF,UAAQG,IAAR,CAAaD,GAAb,EAAkB,YAAY;AAC5BP;AACAK,YAAQI,IAAR,CAAaJ,QAAQK,GAArB,EAA0BH,GAA1B;AACD,GAHD;AAID,CALD","file":"tools/tool-env/cleanup.js.map","sourcesContent":["/// A simple interface to register functions to be called when the process\n/// exits.\n\nvar _ = require('underscore');\n\nvar fiberHelpers = require('../utils/fiber-helpers.js');\n\nvar cleanup = exports;\n_.extend(exports, {\n  _exitHandlers: [],\n\n  // register a function that will be called on SIGINT (e.g. Cmd-C on\n  // mac)\n  onExit: function (func) {\n    this._exitHandlers.push(func);\n  }\n});\n\nvar runHandlers = function () {\n  fiberHelpers.noYieldsAllowed(function () {\n    var handlers = cleanup._exitHandlers;\n    cleanup._exitHandlers = [];\n    _.each(handlers, function (f) {\n      f();\n    });\n  });\n};\n\nprocess.on('exit', runHandlers);\n_.each(['SIGINT', 'SIGHUP', 'SIGTERM'], function (sig) {\n  process.once(sig, function () {\n    runHandlers();\n    process.kill(process.pid, sig);\n  });\n});\n"]}