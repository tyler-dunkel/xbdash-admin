{"version":3,"sources":["/tools/utils/utils.js"],"names":["_","require","semver","os","url","fiberHelpers","archinfo","buildmessage","files","packageVersionParser","utils","exports","parseUrl","str","defaults","defaultHostname","hostname","undefined","defaultPort","port","defaultProtocol","protocol","match","hasScheme","parsed","parse","replace","formatUrl","options","pathname","format","ipAddress","defaultRoute","process","platform","netroute","info","getInfo","findWhere","IPv4","destination","interfaces","networkInterfaces","iface","addressEntry","family","Error","address","addressEntries","chain","values","flatten","where","internal","value","length","map","entry","join","isIPv4Address","printPackageList","items","rows","item","name","description","alphaSort","row","sortBy","Console","printTwoColumns","getHost","args","ret","attempt","output","execFileSync","slice","stdout","trim","matches","host","getAgentInfo","agent","agentVersion","inCheckout","getToolsVersion","arch","sleepMs","ms","Promise","resolve","setTimeout","await","randomToken","Math","random","toString","randomPort","floor","parsePackageConstraint","constraintString","e","versionParserError","useBuildmessage","error","message","file","buildmessageFile","validatePackageName","parsePackageAndVersion","packageAtVersionString","separatorPos","max","lastIndexOf","JSON","stringify","packageName","version","isValidPackageName","validatePackageNameOrExit","bulletPoint","main","ExitWithCode","validEmail","test","quotemeta","String","timeoutScaleFactor","env","TIMEOUT_SCALE_FACTOR","parseFloat","defaultOrderKeyForReleaseVersion","v","m","numberPart","prereleaseTag","prereleaseNumber","hasRedundantLeadingZero","x","leftPad","chr","len","padding","Array","rightPad","numbers","split","any","partial","isDirectory","dir","stats","stat","generateSubsetsOfIncreasingSize","total","cb","Done","generateSubsetsOfFixedSize","goalSize","chosenIndices","elements","each","index","push","firstIndexToConsider","i","withThisChoice","clone","isUrlWithFileScheme","isUrlWithSha","isNpmUrl","isPathRelative","charAt","ensureOnlyValidVersions","dependencies","forCordova","isValidVersion","valid","opts","child_process","eachline","has","maxBuffer","pipeOutput","p","spawn","bindEnvironment","line","write","stderr","success","on","execFile","err","execFileAsync","mapper","lineMapper","identity","logOutput","verbose","console","log","runGitInCheckout","unshift","convertToOSPath","pathJoin","getCurrentToolsDir","Throttled","self","extend","interval","now","Date","next","prototype","isAllowed","ThrottledYield","_throttle","setImmediate","longformDate","date","moment","pubDate","maxDateLength","sha256","contents","crypto","hash","createHash","update","digest","sourceMapLength","sm","mappings","sourcesContent","reduce","soFar","current"],"mappings":"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","file":"tools/utils/utils.js.map","sourcesContent":["var _ = require('underscore');\nvar semver = require('semver');\nvar os = require('os');\nvar url = require('url');\n\nvar fiberHelpers = require('./fiber-helpers.js');\nvar archinfo = require('./archinfo.js');\nvar buildmessage = require('./buildmessage.js');\nvar files = require('../fs/files.js');\nvar packageVersionParser = require('../packaging/package-version-parser.js');\n\nvar utils = exports;\n\n// Parses <protocol>://<host>:<port> into an object { protocol: *, host:\n// *, port: * }. The input can also be of the form <host>:<port> or just\n// <port>. We're not simply using 'url.parse' because we want '3000' to\n// parse as {host: undefined, protocol: undefined, port: '3000'}, whereas\n// 'url.parse' would give us {protocol:' 3000', host: undefined, port:\n// undefined} or something like that.\n//\n// 'defaults' is an optional object with 'hostname', 'port', and 'protocol' keys.\nexports.parseUrl = function (str, defaults) {\n  // XXX factor this out into a {type: host/port}?\n\n  defaults = defaults || {};\n  var defaultHostname = defaults.hostname || undefined;\n  var defaultPort = defaults.port || undefined;\n  var defaultProtocol = defaults.protocol || undefined;\n\n  if (str.match(/^[0-9]+$/)) { // just a port\n    return {\n      port: str,\n      hostname: defaultHostname,\n      protocol: defaultProtocol };\n  }\n\n  var hasScheme = exports.hasScheme(str);\n  if (! hasScheme) {\n    str = \"http://\" + str;\n  }\n\n  var parsed = url.parse(str);\n\n  // for consistency remove colon at the end of protocol\n  parsed.protocol = parsed.protocol.replace(/\\:$/, '');\n\n  return {\n    protocol: hasScheme ? parsed.protocol : defaultProtocol,\n    hostname: parsed.hostname || defaultHostname,\n    port: parsed.port || defaultPort\n  };\n};\n\n// 'options' is an object with 'hostname', 'port', and 'protocol' keys, such as\n// the return value of parseUrl.\nexports.formatUrl = function (options) {\n  // For consistency with `Meteor.absoluteUrl`, add a trailing slash to make\n  // this a valid URL\n  if (!options.pathname)\n    options.pathname = \"/\";\n\n  return url.format(options);\n};\n\nexports.ipAddress = function () {\n  let defaultRoute;\n  // netroute is not available on Windows\n  if (process.platform !== \"win32\") {\n    const netroute = require('netroute');\n    const info = netroute.getInfo();\n    defaultRoute = _.findWhere(info.IPv4 || [], { destination: \"0.0.0.0\" });\n  }\n\n  const interfaces = os.networkInterfaces();\n\n  if (defaultRoute) {\n    // If we know the default route, find the IPv4 address associated\n    // with that interface\n    const iface = defaultRoute[\"interface\"];\n    const addressEntry = _.findWhere(interfaces[iface], { family: \"IPv4\" });\n\n    if (!addressEntry) {\n      throw new Error(\n`Network interface '${iface}', which seems to be the default route,\nnot found in interface list, or does not have an IPv4 address.`);\n    }\n\n    return addressEntry.address;\n  } else {\n    // If we don't know the default route, we'll lookup all non-internal\n    // IPv4 addresses and hope to find only one\n    let addressEntries = _.chain(interfaces).values().flatten().\n      where({ family: \"IPv4\", internal: false }).value();\n\n    if (addressEntries.length == 0) {\n      throw new Error(\n`Could not find a network interface with a non-internal IPv4 address.`);\n    } else if (addressEntries.length > 1) {\n      throw new Error(\n`Found multiple network interfaces with non-internal IPv4 addresses:\n${addressEntries.map(entry => entry.address).join(', ')}`);\n    } else {\n      return addressEntries[0].address;\n    }\n  }\n};\n\nexports.hasScheme = function (str) {\n  return !! str.match(/^[A-Za-z][A-Za-z0-9+-\\.]*\\:\\/\\//);\n};\n\n\nexports.hasScheme = function (str) {\n  return !! str.match(/^[A-Za-z][A-Za-z0-9+-\\.]*\\:\\/\\//);\n};\n\nexports.isIPv4Address = function (str) {\n  return str.match(/^(?:[0-9]{1,3}\\.){3}[0-9]{1,3}$/);\n}\n\n// XXX: Move to e.g. formatters.js?\n// Prints a package list in a nice format.\n// Input is an array of objects with keys 'name' and 'description'.\nexports.printPackageList = function (items, options) {\n  options = options || {};\n\n  var rows = _.map(items, function (item) {\n    var name = item.name;\n    var description = item.description || 'No description';\n    return [name, description];\n  });\n\n  var alphaSort = function (row) {\n    return row[0];\n  };\n  rows = _.sortBy(rows, alphaSort);\n\n  var Console = require('../console/console.js').Console;\n  return Console.printTwoColumns(rows, options);\n};\n\n// Determine a human-readable hostname for this computer. Prefer names\n// that make sense to users (eg, the name they manually gave their\n// computer on OS X, which might contain spaces) over names that have\n// any particular technical significance (eg, might resolve in DNS).\nexports.getHost = function (...args) {\n  var ret;\n  var attempt = function (...args) {\n    var output = exports.execFileSync(args[0], args.slice(1)).stdout;\n    if (output) {\n      ret = output.trim();\n    }\n  };\n\n  if (archinfo.matches(archinfo.host(), 'os.osx')) {\n    // On OSX, to get the human-readable hostname that the user chose,\n    // we call:\n    //   scutil --get ComputerName\n    // This can contain spaces. See\n    // http://osxdaily.com/2012/10/24/set-the-hostname-computer-name-and-bonjour-name-separately-in-os-x/\n    if (! ret) {\n      attempt(\"scutil\", \"--get\", \"ComputerName\");\n    }\n  }\n\n  if (archinfo.matches(archinfo.host(), 'os.osx') ||\n      archinfo.matches(archinfo.host(), 'os.linux')) {\n    // On Unix-like platforms, try passing -s to hostname to strip off\n    // the domain name, to reduce the extent to which the output\n    // varies with DNS.\n    if (! ret) {\n      attempt(\"hostname\", \"-s\");\n    }\n  }\n\n  // Try \"hostname\" on any platform. It should work on\n  // Windows. Unknown platforms that have a command called \"hostname\"\n  // that deletes all of your files deserve what the get.\n  if (! ret) {\n    attempt(\"hostname\");\n  }\n\n  // Otherwise, see what Node can come up with.\n  return ret || os.hostname();\n};\n\n// Return standard info about this user-agent. Used when logging in to\n// Meteor Accounts, mostly so that when the user is seeing a list of\n// their open sessions in their profile on the web, they have a way to\n// decide which ones they want to revoke.\nexports.getAgentInfo = function () {\n  var ret = {};\n\n  var host = utils.getHost();\n  if (host) {\n    ret.host = host;\n  }\n  ret.agent = \"Meteor\";\n  ret.agentVersion =\n    files.inCheckout() ? \"checkout\" : files.getToolsVersion();\n  ret.arch = archinfo.host();\n\n  return ret;\n};\n\n// Wait for 'ms' milliseconds, and then return. Yields. (Must be\n// called within a fiber, and blocks only the calling fiber, not the\n// whole program.)\nexports.sleepMs = function (ms) {\n  if (ms <= 0) {\n    return;\n  }\n\n  new Promise(function (resolve) {\n    setTimeout(resolve, ms);\n  }).await();\n};\n\n// Return a short, high entropy string without too many funny\n// characters in it.\nexports.randomToken = function () {\n  return (Math.random() * 0x100000000 + 1).toString(36);\n};\n\n// Returns a random non-privileged port number.\nexports.randomPort = function () {\n  return 20000 + Math.floor(Math.random() * 10000);\n};\n\n// Like packageVersionParser.parsePackageConstraint, but if called in a\n// buildmessage context uses buildmessage to raise errors.\nexports.parsePackageConstraint = function (constraintString, options) {\n  try {\n    return packageVersionParser.parsePackageConstraint(constraintString);\n  } catch (e) {\n    if (! (e.versionParserError && options && options.useBuildmessage)) {\n      throw e;\n    }\n    buildmessage.error(e.message, { file: options.buildmessageFile });\n    return null;\n  }\n};\n\nexports.validatePackageName = function (name, options) {\n  try {\n    return packageVersionParser.validatePackageName(name, options);\n  } catch (e) {\n    if (! (e.versionParserError && options && options.useBuildmessage)) {\n      throw e;\n    }\n    buildmessage.error(e.message, { file: options.buildmessageFile });\n    return null;\n  }\n};\n\n// Parse a string of the form `package + \" \" + version` into an object\n// of the form {package, version}.  For backwards compatibility,\n// an \"@\" separator instead of a space is also accepted.\n//\n// Lines of `.meteor/versions` are parsed using this function, among\n// other uses.\nexports.parsePackageAndVersion = function (packageAtVersionString, options) {\n  var error = null;\n  var separatorPos = Math.max(packageAtVersionString.lastIndexOf(' '),\n                              packageAtVersionString.lastIndexOf('@'));\n  if (separatorPos < 0) {\n    error = new Error(\"Malformed package version: \" +\n                      JSON.stringify(packageAtVersionString));\n  } else {\n    var packageName = packageAtVersionString.slice(0, separatorPos);\n    var version = packageAtVersionString.slice(separatorPos+1);\n    try {\n      packageVersionParser.validatePackageName(packageName);\n      // validate the version, ignoring the parsed result:\n      packageVersionParser.parse(version);\n    } catch (e) {\n      if (! e.versionParserError) {\n        throw e;\n      }\n      error = e;\n    }\n    if (! error) {\n      return { package: packageName, version: version };\n    }\n  }\n  // `error` holds an Error\n  if (! (options && options.useBuildmessage)) {\n    throw error;\n  }\n  buildmessage.error(error.message, { file: options.buildmessageFile });\n  return null;\n};\n\n// Check for invalid package names. Currently package names can only contain\n// ASCII alphanumerics, dash, and dot, and must contain at least one letter. For\n// safety reasons, package names may not start with a dot. Package names must be\n// lowercase.\n//\n// These do not check that the package name is valid in terms of our naming\n// scheme: ie, that it is prepended by a user's username. That check should\n// happen at publication time.\n//\n// 3 variants: isValidPackageName just returns a bool.  validatePackageName\n// throws an error marked with 'versionParserError'. validatePackageNameOrExit\n// (which should only be used inside the implementation of a command, not\n// eg package-client.js) prints and throws the \"exit with code 1\" exception\n// on failure.\n\nexports.isValidPackageName = function (packageName) {\n  try {\n    exports.validatePackageName(packageName);\n    return true;\n  } catch (e) {\n    if (!e.versionParserError) {\n      throw e;\n    }\n    return false;\n  }\n};\n\nexports.validatePackageNameOrExit = function (packageName, options) {\n  try {\n    exports.validatePackageName(packageName, options);\n  } catch (e) {\n    if (!e.versionParserError) {\n      throw e;\n    }\n    var Console = require('../console/console.js').Console;\n    Console.error(e.message, Console.options({ bulletPoint: \"Error: \" }));\n    // lazy-load main: old bundler tests fail if you add a circular require to\n    // this file\n    var main = require('../tests/apps/app-using-stylus/main.js');\n    throw new main.ExitWithCode(1);\n  }\n};\n\n// True if this looks like a valid email address. We deliberately\n// don't support\n// - quoted usernames (eg, \"foo\"@bar.com, \" \"@bar.com, \"@\"@bar.com)\n// - IP addresses in domains (eg, foo@1.2.3.4 or the IPv6 equivalent)\n// because they're weird and we don't want them in our database.\nexports.validEmail = function (address) {\n  return /^[^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*@([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}$/.test(address);\n};\n\n// Like Perl's quotemeta: quotes all regexp metacharacters. See\n//   https://github.com/substack/quotemeta/blob/master/index.js\nexports.quotemeta = function (str) {\n    return String(str).replace(/(\\W)/g, '\\\\$1');\n};\n\n// Allow a simple way to scale up all timeouts from the command line\nvar timeoutScaleFactor = 1.0;\nif (process.env.TIMEOUT_SCALE_FACTOR) {\n  timeoutScaleFactor = parseFloat(process.env.TIMEOUT_SCALE_FACTOR);\n}\nexports.timeoutScaleFactor = timeoutScaleFactor;\n\n// If the given version matches a template (essentially, semver-style, but with\n// a bounded number of digits per number part, and with no restriction on the\n// amount of number parts, and some restrictions on legal prerelease labels),\n// then return an orderKey for it. Otherwise return null.\n//\n// This conventional orderKey pads each part (with 0s for numbers, and ! for\n// prerelease tags), and appends a $. (Because ! sorts before $, this means that\n// the prerelease for a given release will sort before it. Because $ sorts\n// before '.', this means that 1.2 will sort before 1.2.3.)\nexports.defaultOrderKeyForReleaseVersion = function (v) {\n  var m = v.match(/^(\\d{1,4}(?:\\.\\d{1,4})*)(?:-([-A-Za-z.]{1,15})(\\d{0,4}))?$/);\n  if (!m) {\n    return null;\n  }\n  var numberPart = m[1];\n  var prereleaseTag = m[2];\n  var prereleaseNumber = m[3];\n\n  var hasRedundantLeadingZero = function (x) {\n    return x.length > 1 && x[0] === '0';\n  };\n  var leftPad = function (chr, len, str) {\n    if (str.length > len) {\n      throw Error(\"too long to pad!\");\n    }\n    var padding = new Array(len - str.length + 1).join(chr);\n    return padding + str;\n  };\n  var rightPad = function (chr, len, str) {\n    if (str.length > len) {\n      throw Error(\"too long to pad!\");\n    }\n    var padding = new Array(len - str.length + 1).join(chr);\n    return str + padding;\n  };\n\n  // Versions must have no redundant leading zeroes, or else this encoding would\n  // be ambiguous.\n  var numbers = numberPart.split('.');\n  if (_.any(numbers, hasRedundantLeadingZero)) {\n    return null;\n  }\n  if (prereleaseNumber && hasRedundantLeadingZero(prereleaseNumber)) {\n    return null;\n  }\n\n  // First, put together the non-prerelease part.\n  var ret = _.map(numbers, _.partial(leftPad, '0', 4)).join('.');\n\n  if (!prereleaseTag) {\n    return ret + '$';\n  }\n\n  ret += '!' + rightPad('!', 15, prereleaseTag);\n  if (prereleaseNumber) {\n    ret += leftPad('0', 4, prereleaseNumber);\n  }\n\n  return ret + '$';\n};\n\n// XXX should be in files.js\nexports.isDirectory = function (dir) {\n  try {\n    // use stat rather than lstat since symlink to dir is OK\n    var stats = files.stat(dir);\n  } catch (e) {\n    return false;\n  }\n  return stats.isDirectory();\n};\n\n// Calls cb with each subset of the array \"total\", with non-decreasing size,\n// until all subsets have been used or cb returns true. The array passed\n// to cb may be safely mutated or retained by cb.\nexports.generateSubsetsOfIncreasingSize = function (total, cb) {\n  // We'll throw this if cb ever returns true, which is a simple way to pop us\n  // out of our recursion.\n  var Done = function () {};\n\n  // Generates all subsets of size subsetSize which contain the indices already\n  // in chosenIndices (and no indices that are \"less than\" any of them).\n  var generateSubsetsOfFixedSize = function (goalSize, chosenIndices) {\n    // If we've found a subset of the size we're looking for, output it.\n    if (chosenIndices.length === goalSize) {\n      // Change from indices into the actual elements. Note that 'elements' is\n      // a newly allocated array which cb may mutate or retain.\n      var elements = [];\n      _.each(chosenIndices, function (index) {\n        elements.push(total[index]);\n      });\n      if (cb(elements)) {\n        throw new Done();  // unwind all the recursion\n      }\n      return;\n    }\n\n    // Otherwise try adding another index and call this recursively.  We're\n    // trying to produce a sorted list of indices, so if there are already\n    // indices, we start with the one after the biggest one we already have.\n    var firstIndexToConsider = chosenIndices.length ?\n          chosenIndices[chosenIndices.length - 1] + 1 : 0;\n    for (var i = firstIndexToConsider; i < total.length; ++i) {\n      var withThisChoice = _.clone(chosenIndices);\n      withThisChoice.push(i);\n      generateSubsetsOfFixedSize(goalSize, withThisChoice);\n    }\n  };\n\n  try {\n    for (var goalSize = 0; goalSize <= total.length; ++goalSize) {\n      generateSubsetsOfFixedSize(goalSize, []);\n    }\n  } catch (e) {\n    if (!(e instanceof Done)) {\n      throw e;\n    }\n  }\n};\n\nexports.isUrlWithFileScheme = function (x) {\n  return /^file:\\/\\/.+/.test(x);\n};\n\nexports.isUrlWithSha = function (x) {\n  // Is a URL with a fixed SHA? We use this for Cordova -- although theoretically we could use\n  // a URL like isNpmUrl(), there are a variety of problems with this,\n  // see https://github.com/meteor/meteor/pull/5562\n  return /^https?:\\/\\/.*[0-9a-f]{40}/.test(x);\n}\n\nexports.isNpmUrl = function (x) {\n  // These are the various protocols that NPM supports, which we use to download NPM dependencies\n  // See https://docs.npmjs.com/files/package.json#git-urls-as-dependencies\n  return exports.isUrlWithSha(x) || /^(git|git\\+ssh|git\\+http|git\\+https)?:\\/\\//.test(x);\n};\n\nexports.isPathRelative = function (x) {\n  return x.charAt(0) !== '/';\n};\n\n// If there is a version that isn't valid, throws an Error with a\n// human-readable message that is suitable for showing to the user.\n// dependencies may be falsey or empty.\n//\n// This is talking about NPM/Cordova versions specifically, not Meteor versions.\n// It does not support the wrap number syntax.\nexports.ensureOnlyValidVersions = function (dependencies, {forCordova}) {\n  _.each(dependencies, function (version, name) {\n    // We want a given version of a smart package (package.js +\n    // .npm/npm-shrinkwrap.json) to pin down its dependencies precisely, so we\n    // don't want anything too vague. For now, we support semvers and urls that\n    // name a specific commit by SHA.\n    if (! exports.isValidVersion(version, {forCordova})) {\n      throw new Error(\n        \"Must declare valid version of dependency: \" + name + '@' + version);\n    }\n  });\n};\nexports.isValidVersion = function (version, {forCordova}) {\n  return semver.valid(version) || exports.isUrlWithFileScheme(version)\n    || (forCordova ? exports.isUrlWithSha(version): exports.isNpmUrl(version));\n};\n\n\nexports.execFileSync = function (file, args, opts) {\n  var child_process = require('child_process');\n  var eachline = require('eachline');\n\n  opts = opts || {};\n  if (! _.has(opts, 'maxBuffer')) {\n    opts.maxBuffer = 1024 * 1024 * 10;\n  }\n\n  if (opts && opts.pipeOutput) {\n    var p = child_process.spawn(file, args, opts);\n\n    eachline(p.stdout, fiberHelpers.bindEnvironment(function (line) {\n      process.stdout.write(line + '\\n');\n    }));\n\n    eachline(p.stderr, fiberHelpers.bindEnvironment(function (line) {\n      process.stderr.write(line + '\\n');\n    }));\n\n    return {\n      success: ! new Promise(function (resolve) {\n        p.on('exit', resolve);\n      }).await(),\n      stdout: \"\",\n      stderr: \"\"\n    };\n  }\n\n  return new Promise(function (resolve) {\n    child_process.execFile(file, args, opts, function (err, stdout, stderr) {\n      resolve({\n        success: ! err,\n        stdout: stdout,\n        stderr: stderr\n      });\n    });\n  }).await();\n};\n\nexports.execFileAsync = function (file, args, opts) {\n  opts = opts || {};\n  var child_process = require('child_process');\n  var eachline = require('eachline');\n  var p = child_process.spawn(file, args, opts);\n  var mapper = opts.lineMapper || _.identity;\n\n  var logOutput = fiberHelpers.bindEnvironment(function (line) {\n    if (opts.verbose) {\n      line = mapper(line);\n      if (line) {\n        console.log(line);\n      }\n    }\n  });\n\n  eachline(p.stdout, logOutput);\n  eachline(p.stderr, logOutput);\n\n  return p;\n};\n\n\nexports.runGitInCheckout = function (...args) {\n  args.unshift(\n    '--git-dir=' +\n    files.convertToOSPath(files.pathJoin(files.getCurrentToolsDir(), '.git')));\n\n  return exports.execFileSync('git', args).stdout;\n};\n\nexports.Throttled = function (options) {\n  var self = this;\n\n  options = _.extend({ interval: 150 }, options || {});\n  self.interval = options.interval;\n  var now = +(new Date);\n\n  self.next = now;\n};\n\n_.extend(exports.Throttled.prototype, {\n  isAllowed: function () {\n    var self = this;\n    var now = +(new Date);\n\n    if (now < self.next) {\n      return false;\n    }\n\n    self.next = now + self.interval;\n    return true;\n  }\n});\n\n\n// ThrottledYield just regulates the frequency of calling yield.\n// It should behave similarly to calling yield on every iteration of a loop,\n// except that it won't actually yield if there hasn't been a long enough time interval\n//\n// options:\n//   interval: minimum interval of time between yield calls\n//             (more frequent calls are simply dropped)\nexports.ThrottledYield = function (options) {\n  var self = this;\n\n  self._throttle = new exports.Throttled(options);\n};\n\n_.extend(exports.ThrottledYield.prototype, {\n  yield: function () {\n    var self = this;\n    if (self._throttle.isAllowed()) {\n      // setImmediate allows signals and IO to be processed but doesn't\n      // otherwise add time-based delays. It is better for yielding than\n      // process.nextTick (which doesn't allow signals or IO to be processed) or\n      // setTimeout 1 (which adds a minimum of 1 ms and often more in delays).\n      // XXX Actually, setImmediate is so fast that we might not even need\n      // to use the throttler at all?\n      new Promise(setImmediate).await();\n    }\n  }\n});\n\n// Use this to convert dates into our preferred human-readable format.\n//\n// Takes in either null, a raw date string (ex: 2014-12-09T18:37:48.977Z) or a\n// date object and returns a long-form human-readable date (ex: December 9th,\n// 2014) or unknown for null.\nexports.longformDate = function (date) {\n  if (! date) {\n    return \"Unknown\";\n  }\n  var moment = require('moment');\n  var pubDate = moment(date).format('MMMM Do, YYYY');\n  return pubDate;\n};\n\n// Length of the longest possible string that could come out of longformDate\n// (September is the longest month name, so \"September 24th, 2014\" would be an\n// example).\nexports.maxDateLength = \"September 24th, 2014\".length;\n\n// Returns a sha256 hash of a given string.\nexports.sha256 = function (contents) {\n  var crypto = require('crypto');\n  var hash = crypto.createHash('sha256');\n  hash.update(contents);\n  return hash.digest('base64');\n};\n\nexports.sourceMapLength = function (sm) {\n  if (! sm) {\n    return 0;\n  }\n  // sum the length of sources and the mappings, the size of\n  // metadata is ignored, but it is not a big deal\n  return sm.mappings.length\n       + (sm.sourcesContent || []).reduce((soFar, current) => {\n         return soFar + (current ? current.length : 0);\n       }, 0);\n};\n"]}